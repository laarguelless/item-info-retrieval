package org.laarguelless.rest.clients;

import com.google.gson.Gson;
import org.junit.jupiter.api.Test;
import org.laarguelless.json.GsonBuilderFactory;
import org.laarguelless.rest.clients.dto.ImmutableItemDto;
import org.laarguelless.rest.clients.dto.ItemDto;

import javax.ws.rs.client.Client;
import javax.ws.rs.core.Response;

import java.math.BigInteger;
import java.time.OffsetDateTime;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

class ItemRestClientTest {

    @Test
    void parseValueFromResponse() {
        Gson gson = GsonBuilderFactory.GSON;

        String json = "{\"id\":\"MLU460998489\",\"site_id\":\"MLU\",\"title\":\"Google Pixel 32gb Silver - Impecable!\",\"subtitle\":null,\"seller_id\":79404795,\"category_id\":\"MLU1055\",\"official_store_id\":null,\"price\":350,\"base_price\":350,\"original_price\":null,\"currency_id\":\"USD\",\"initial_quantity\":1,\"available_quantity\":1,\"sold_quantity\":0,\"sale_terms\":[{\"id\":\"WARRANTY_TYPE\",\"name\":\"Tipo de garantía\",\"value_id\":\"6150835\",\"value_name\":\"Sin garantía\",\"value_struct\":null,\"values\":[{\"id\":\"6150835\",\"name\":\"Sin garantía\",\"struct\":null}]}],\"buying_mode\":\"buy_it_now\",\"listing_type_id\":\"gold_special\",\"start_time\":\"2019-03-02T20:31:02.000Z\",\"stop_time\":\"2019-10-25T23:28:35.000Z\",\"condition\":\"used\",\"permalink\":\"https://articulo.mercadolibre.com.uy/MLU-460998489-google-pixel-32gb-silver-impecable-_JM\",\"thumbnail\":\"http://http2.mlstatic.com/D_668917-MLU29543669123_032019-I.jpg\",\"secure_thumbnail\":\"https://http2.mlstatic.com/D_668917-MLU29543669123_032019-I.jpg\",\"pictures\":[{\"id\":\"668917-MLU29543669123_032019\",\"url\":\"http://http2.mlstatic.com/D_668917-MLU29543669123_032019-O.jpg\",\"secure_url\":\"https://http2.mlstatic.com/D_668917-MLU29543669123_032019-O.jpg\",\"size\":\"500x375\",\"max_size\":\"1008x756\",\"quality\":\"\"},{\"id\":\"697095-MLU29543622297_032019\",\"url\":\"http://http2.mlstatic.com/D_697095-MLU29543622297_032019-O.jpg\",\"secure_url\":\"https://http2.mlstatic.com/D_697095-MLU29543622297_032019-O.jpg\",\"size\":\"500x375\",\"max_size\":\"1008x756\",\"quality\":\"\"},{\"id\":\"773315-MLU29543695538_032019\",\"url\":\"http://http2.mlstatic.com/D_773315-MLU29543695538_032019-O.jpg\",\"secure_url\":\"https://http2.mlstatic.com/D_773315-MLU29543695538_032019-O.jpg\",\"size\":\"375x500\",\"max_size\":\"756x1008\",\"quality\":\"\"},{\"id\":\"877139-MLU29543686580_032019\",\"url\":\"http://http2.mlstatic.com/D_877139-MLU29543686580_032019-O.jpg\",\"secure_url\":\"https://http2.mlstatic.com/D_877139-MLU29543686580_032019-O.jpg\",\"size\":\"375x500\",\"max_size\":\"756x1008\",\"quality\":\"\"}],\"video_id\":null,\"descriptions\":[{\"id\":\"MLU460998489-1999164048\"}],\"accepts_mercadopago\":true,\"non_mercado_pago_payment_methods\":[],\"shipping\":{\"mode\":\"me2\",\"free_methods\":[{\"id\":505445,\"rule\":{\"free_mode\":\"country\",\"value\":null}}],\"tags\":[],\"dimensions\":null,\"local_pick_up\":true,\"free_shipping\":true,\"logistic_type\":\"drop_off\",\"store_pick_up\":false},\"international_delivery_mode\":\"none\",\"seller_address\":{\"city\":{\"id\":\"TUxVQ1BBTDU0NzY\",\"name\":\"Palermo\"},\"state\":{\"id\":\"UY-MO\",\"name\":\"Montevideo\"},\"country\":{\"id\":\"UY\",\"name\":\"Uruguay\"},\"search_location\":{\"city\":{\"id\":\"TUxVQ01PTjc2Nzc\",\"name\":\"Montevideo\"},\"state\":{\"id\":\"TUxVUE1PTlo2MDIy\",\"name\":\"Montevideo\"}},\"latitude\":-34.91096,\"longitude\":-56.182693,\"id\":57890546},\"seller_contact\":null,\"location\":{},\"geolocation\":{\"latitude\":-34.91096,\"longitude\":-56.182693},\"coverage_areas\":[],\"attributes\":[{\"id\":\"BATTERY_CAPACITY\",\"name\":\"Capacidad de la batería\",\"value_id\":\"7619217\",\"value_name\":\"2770 mAh\",\"value_struct\":{\"number\":2770,\"unit\":\"mAh\"},\"values\":[{\"id\":\"7619217\",\"name\":\"2770 mAh\",\"struct\":{\"number\":2770,\"unit\":\"mAh\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"BATTERY_TYPE\",\"name\":\"Tipo de batería\",\"value_id\":\"7573635\",\"value_name\":\"Li-Ion\",\"value_struct\":null,\"values\":[{\"id\":\"7573635\",\"name\":\"Li-Ion\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"BRAND\",\"name\":\"Marca\",\"value_id\":\"52701\",\"value_name\":\"Google\",\"value_struct\":null,\"values\":[{\"id\":\"52701\",\"name\":\"Google\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"DEPTH\",\"name\":\"Profundidad\",\"value_id\":null,\"value_name\":\"8 mm\",\"value_struct\":{\"number\":8,\"unit\":\"mm\"},\"values\":[{\"id\":null,\"name\":\"8 mm\",\"struct\":{\"number\":8,\"unit\":\"mm\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"DISPLAY_RESOLUTION\",\"name\":\"Resolución de la pantalla\",\"value_id\":\"7199626\",\"value_name\":\"1080 px x 1920 px\",\"value_struct\":null,\"values\":[{\"id\":\"7199626\",\"name\":\"1080 px x 1920 px\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"DISPLAY_SIZE\",\"name\":\"Tamaño de la pantalla\",\"value_id\":\"4328109\",\"value_name\":\"5 \\\"\",\"value_struct\":{\"number\":5,\"unit\":\"\\\"\"},\"values\":[{\"id\":\"4328109\",\"name\":\"5 \\\"\",\"struct\":{\"number\":5,\"unit\":\"\\\"\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"HEIGHT\",\"name\":\"Altura\",\"value_id\":null,\"value_name\":\"144 mm\",\"value_struct\":{\"number\":144,\"unit\":\"mm\"},\"values\":[{\"id\":null,\"name\":\"144 mm\",\"struct\":{\"number\":144,\"unit\":\"mm\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"INTERNAL_MEMORY\",\"name\":\"Memoria interna\",\"value_id\":\"59725\",\"value_name\":\"32 GB\",\"value_struct\":{\"number\":32,\"unit\":\"GB\"},\"values\":[{\"id\":\"59725\",\"name\":\"32 GB\",\"struct\":{\"number\":32,\"unit\":\"GB\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"IS_SPLASH_RESISTANT\",\"name\":\"Es resistente a salpicaduras\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"ITEM_CONDITION\",\"name\":\"Condición del ítem\",\"value_id\":\"2230581\",\"value_name\":\"Usado\",\"value_struct\":null,\"values\":[{\"id\":\"2230581\",\"name\":\"Usado\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"MODEL\",\"name\":\"Modelo\",\"value_id\":\"381684\",\"value_name\":\"Pixel\",\"value_struct\":null,\"values\":[{\"id\":\"381684\",\"name\":\"Pixel\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"OPERATING_SYSTEM_NAME\",\"name\":\"Nombre del sistema operativo\",\"value_id\":\"7403813\",\"value_name\":\"Android\",\"value_struct\":null,\"values\":[{\"id\":\"7403813\",\"name\":\"Android\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"OPERATING_SYSTEM_VERSION\",\"name\":\"Versión del sistema operativo\",\"value_id\":\"7211302\",\"value_name\":\"9 Pie\",\"value_struct\":null,\"values\":[{\"id\":\"7211302\",\"name\":\"9 Pie\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"PROCESSOR_SPEED\",\"name\":\"Velocidad del procesador\",\"value_id\":\"365947\",\"value_name\":\"1.6 GHz\",\"value_struct\":{\"number\":1.6,\"unit\":\"GHz\"},\"values\":[{\"id\":\"365947\",\"name\":\"1.6 GHz\",\"struct\":{\"number\":1.6,\"unit\":\"GHz\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"RAM\",\"name\":\"Memoria RAM\",\"value_id\":\"98852\",\"value_name\":\"4 GB\",\"value_struct\":{\"number\":4,\"unit\":\"GB\"},\"values\":[{\"id\":\"98852\",\"name\":\"4 GB\",\"struct\":{\"number\":4,\"unit\":\"GB\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"SCREEN_TECHNOLOGY\",\"name\":\"Tecnología de pantalla\",\"value_id\":\"80492\",\"value_name\":\"AMOLED\",\"value_struct\":null,\"values\":[{\"id\":\"80492\",\"name\":\"AMOLED\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WEIGHT\",\"name\":\"Peso\",\"value_id\":\"522899\",\"value_name\":\"143 g\",\"value_struct\":{\"number\":143,\"unit\":\"g\"},\"values\":[{\"id\":\"522899\",\"name\":\"143 g\",\"struct\":{\"number\":143,\"unit\":\"g\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WIDTH\",\"name\":\"Ancho\",\"value_id\":null,\"value_name\":\"69 mm\",\"value_struct\":{\"number\":69,\"unit\":\"mm\"},\"values\":[{\"id\":null,\"name\":\"69 mm\",\"struct\":{\"number\":69,\"unit\":\"mm\"}}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_ACCELEROMETER\",\"name\":\"Con acelerómetro\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_BLUETOOTH\",\"name\":\"Con Bluetooth\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_CAMERA\",\"name\":\"Con cámara\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_GPS\",\"name\":\"Con GPS\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_GYROSCOPE\",\"name\":\"Con giroscopio\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_PROXIMITY_SENSOR\",\"name\":\"Con sensor de proximidad\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_REMOVABLE_BATTERY\",\"name\":\"Con batería removible\",\"value_id\":\"242084\",\"value_name\":\"No\",\"value_struct\":null,\"values\":[{\"id\":\"242084\",\"name\":\"No\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"},{\"id\":\"WITH_WIFI\",\"name\":\"Con Wi-Fi\",\"value_id\":\"242085\",\"value_name\":\"Sí\",\"value_struct\":null,\"values\":[{\"id\":\"242085\",\"name\":\"Sí\",\"struct\":null}],\"attribute_group_id\":\"OTHERS\",\"attribute_group_name\":\"Otros\"}],\"warnings\":[],\"listing_source\":\"\",\"variations\":[{\"id\":41477398432,\"price\":350,\"attribute_combinations\":[{\"id\":\"COLOR\",\"name\":\"Color\",\"value_id\":\"52055\",\"value_name\":\"Blanco\",\"value_struct\":null,\"values\":[{\"id\":\"52055\",\"name\":\"Blanco\",\"struct\":null}]}],\"available_quantity\":1,\"sold_quantity\":0,\"sale_terms\":[],\"picture_ids\":[\"668917-MLU29543669123_032019\",\"697095-MLU29543622297_032019\",\"773315-MLU29543695538_032019\",\"877139-MLU29543686580_032019\"],\"catalog_product_id\":\"MLU6292202\"}],\"status\":\"closed\",\"sub_status\":[\"deleted\"],\"tags\":[\"poor_quality_picture\",\"immediate_payment\",\"cart_eligible\"],\"warranty\":null,\"catalog_product_id\":\"MLU6292202\",\"domain_id\":\"MLU-CELLPHONES\",\"parent_item_id\":null,\"differential_pricing\":null,\"deal_ids\":[],\"automatic_relist\":false,\"date_created\":\"2019-03-02T20:31:02.000Z\",\"last_updated\":\"2019-12-17T12:31:52.000Z\",\"health\":0.85,\"catalog_listing\":false}";


        Response response = mock(Response.class);
        when(response.readEntity(String.class)).thenReturn(json);
        Client client = mock(Client.class);
        String url = "";

        ItemRestClient itemRestClient = new ItemRestClient(client,url,gson);

        ItemDto expected = ImmutableItemDto.builder()
                .id("MLU460998489")
                .categoryId("MLU1055")
                .title("Google Pixel 32gb Silver - Impecable!")
                .price(BigInteger.valueOf(350L))
                .startTime(OffsetDateTime.parse("2019-03-02T20:31:02Z"))
                .stopTime(OffsetDateTime.parse("2019-10-25T23:28:35Z")).build();

        Optional<ItemDto> actual = itemRestClient.parseValueFromResponse(response);
        assertEquals(Optional.of(expected),actual);
    }

    @Test
    void getEmptyValue() {
    }
}